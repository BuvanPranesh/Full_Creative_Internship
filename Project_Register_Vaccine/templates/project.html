<html>
<head>
     <link rel="stylesheet" type="text/css" href="{{url_for('static',filename='/css/check.css')}}">
     <title>Operation</title>
        <style>
        table, th , td {
  border: 1px solid black;
  border-collapse: collapse;
}
</style>
</head>
<body>

    <!-- Search the city-->


        <div id="search-city">
            <form id='search_city'>
                <p>Field:<select required name ="field" id="field1" oninvalid="setCustomValidity('select the field')" oninput="setCustomValidity('')">
                    <option value="chennai">chennai</option>
                    <option value="coimbatore">coimbatore</option>
                    <option value="erode">erode</option>
                    </select>
                <button type="submit" id="city-search">Search</button></p>
                <p><button type="submit" id="registered_user">Display Registration</button></p>
            </form>
        </div>


        <div id="register" class="details1">
            <form>
                <p>Name:<input type="text" name="name" id="name1"  placeholder="Enter name" required  pattern="^[a-zA-z]{3,}[ ]{0,1}[a-zA-Z]{0,}[ ]{0,1}[a-zA-Z]{0,1}[ ]{0,1}[a-zA-z]{0,1}" oninvalid="setCustomValidity('should contains only characters')" oninput="setCustomValidity('')"></p>
                <p>Age:<input type="text" name="age" id="age1"  placeholder="Enter age" required  pattern="^[0-9]{1,3}" oninvalid="setCustomValidity('should contains only numbers')" oninput="setCustomValidity('')"></p>
                <p>Aadhaar Number:<input type="text" name="aadhaar_no" id="aadhaar1" placeholder="Enter Aadhaar Number" required  pattern="^[0-9]{4}[ ]{0,1}[0-9]{4}[ ]{0,1}[0-9]{4}" oninvalid="setCustomValidity('should contains only numbers i.e 12 digit aadhaar Number')" oninput="setCustomValidity('')"></p>
                <p>Phone Number:<input type="text" name="phone_no" id="phone1" placeholder="Enter Phone Number" required  pattern="^[0-9]{10}" oninvalid="setCustomValidity('should contains only characters')" oninput="setCustomValidity('')"></p>
                <p>Address:</P>
                <textarea name="address" id="address1" rows="4" cols="50" required></textarea>
                <p><button type="submit" id="register_vaccine">Register</button></p>
            </form>
        </div>



        <div id="search_results" class="details1"></div>

        <div id="display_results" class="details1"></div>


    <!-- import script-->


    <script>
        var table_content="";
        var row_count=1;
        var table_header="";
        var table_footer="";
        var display_count=1;




        document.getElementById('city-search').addEventListener('click',search);


        function search(event){
            row_count=1;
            table_header="";
            table_content="";
            table_footer="";
            document.getElementById('display_results').classList.add('details1');
            document.getElementById('search_results').classList.remove('details1');
            document.getElementById('search_results').innerHTML="";
            event.preventDefault();
            searchCity();
        }


        function searchCity(){
            document.getElementById('search_results').innerHTML="";
            var xhr = new XMLHttpRequest();
            var x = document.getElementById('field1').value;
            var url = '/search?field='+x;
            xhr.open('GET',url,true);
            xhr.onload = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response_server = JSON.parse(xhr.responseText);
                    for(var i=0; i<response_server.vaccine.length; i++){
                        var no = response_server.vaccine[i].no;
                        var city = response_server.vaccine[i].city;
                        var vaccine_place = response_server.vaccine[i].vaccine_centre;
                        var slots_remaining = response_server.vaccine[i].slots_available;
                        var key_id_vaccine = response_server.vaccine[i].key_id;
                        create_table(no,city,vaccine_place,slots_remaining,key_id_vaccine);
                    }
                }
            }
            xhr.send();
        }


        function create_table(v1,v2,v3,v4,v5){
         document.getElementById('search_results').classList.remove('details1');
         console.log(v5);
            if(row_count==1){
                var table_header = '<table style="width:75%">\n';
                table_content+='<tr>';
                table_content+='<th align="center">'+ "No"+'</th>';
                table_content+='<th align="center">'+ "City" +'</th>';
                table_content+='<th align="center">'+ "Vaccine Center" +'</th>';
                table_content+='<th align="center">'+ "Vaccine Available" +'</th>';
                table_content+='<th align="center">'+ "Book Vaccine" +'</th>';
                table_content+= '</tr>\n';
                var table_footer= '</table>';
                document.getElementById('search_results').innerHTML = table_header+ table_content+ table_footer;
                row_count+=1;
            }
                console.log(v5);
                var table_header = '<table style="width:75%">\n';
                table_content+= '<tr>';
                table_content+='<td align="center" >'+ v1 +'</td>';
                table_content+='<td align="center">'+ v2 +'</td>';
                table_content+='<td align="center" id=row_count>'+ v3 +'</td>';
                table_content+='<td align="center">'+ v4 +'</td>';
                table_content+='<td align="center">'+ `<button onclick=register('${v5}')>Book Now</button>` +'</td>';
                table_content+='</tr>\n';
                var table_footer='</table>';
                document.getElementById('search_results').innerHTML = table_header + table_content + table_footer;
                row_count+=1;
        }


        function register(v5){
            document.getElementById('search_results').classList.add('details1');
            document.getElementById('register').classList.remove('details1');
            document.getElementById('register_vaccine').addEventListener('click',function(event){
            event.preventDefault();
            registered(v5);});
        }

        function registered(v5){
            let name = document.getElementById('name1').value;
            let age = document.getElementById('age1').value;
            let aadhaar_no = document.getElementById('aadhaar1').value;
            let phone_no = document.getElementById('phone1').value;
            let address = document.getElementById('address1').value;
            register_add(name,age,aadhaar_no,phone_no,address,v5);
        }

            function register_add(a1,a2,a3,a4,a5,id1){
                alert(id1);
                var para ='name=a1&age=a2&aadhaar_no=a3&phone_no=a4&address=a5';
                var xhr = new XMLHttpRequest();
                xhr.open('POST','/register',true);
                xhr.send(para);
            }
            document.getElementById('registered_user').addEventListener('click',registration);


        function registration(event){
            event.preventDefault();
            display_count=1;
            table_header="";
            table_content="";
            table_footer="";
            document.getElementById('search_results').classList.add('details1');
            document.getElementById('display_results').classList.remove('details1');
            document.getElementById('display_results').innerHTML="";
            displayRegistration();
        }


        function displayRegistration(){
            var xhr = new XMLHttpRequest();
            var url = '/displayRegistration';
            xhr.open('GET',url,true);
            xhr.onload = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response_server = JSON.parse(xhr.responseText);
                    for(var i=0; i<response_server.register_vaccine.length; i++){
                        var c = response_server.register_vaccine[i].total_registration;
                        var name = response_server.register_vaccine[i].name;
                        var age = response_server.register_vaccine[i].age;
                        var aadhaar_no = response_server.register_vaccine[i].aadhaar_no;
                        var phone_no = response_server.register_vaccine[i].phone_no;
                        var address = response_server.register_vaccine[i].address;
                        display_results(c,name,age,aadhaar_no,phone_no,address);
                    }
                }
            }
            xhr.send();
        }


    function display_results(v1,v2,v3,v4,v5,v6){
     document.getElementById('display_results').classList.remove('details1');
            if(display_count==1){
                var table_header='<table style="width:75%">\n';
                table_content+='<tr>';
                table_content+='<th align="center">'+ "Registration No"+'</th>';
                table_content+='<th align="center">'+ "Name" +'</th>';
                table_content+='<th align="center">'+ "Age" +'</th>';
                table_content+='<th align="center">'+ "Aadhaar No" +'</th>';
                table_content+='<th align="center">'+ "Phone No" +'</th>';
                table_content+='<th align="center">'+ "Address" +'</th>';
                table_content+='</tr>\n';
                var table_footer='</table>';
                document.getElementById('display_results').innerHTML = table_header + table_content + table_footer;
                display_count+=1;
            }
                var table_header = '<table style="width:75%">\n';
                table_content+='<tr>';
                table_content+='<td align="center">'+ v1 +'</td>';
                table_content+='<td align="center">'+ v2 +'</td>';
                table_content+='<td align="center">'+ v3 +'</td>';
                table_content+='<td align="center">'+ v4 +'</td>';
                table_content+='<td align="center">'+ v5 +'</td>';
                table_content+='<td align="center">'+ v6 +'</td>';
                table_content+='</tr>\n';
                var table_footer='</table>';
                document.getElementById('display_results').innerHTML = table_header + table_content + table_footer;
         }

    </script>
</body>
</html>
